<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
       "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
  <title>
    <%= session[:organisation].name if session.has_key?(:organisation) %>
    <%= " - " + @school.displayName if not @school.nil? %>
  </title>
  <%= stylesheet_link_tag "#{theme}/screen.css", :media => 'screen, projection' %>
  <%= stylesheet_link_tag "#{theme}/print.css", :media => 'print' %>
  <%= stylesheet_link_tag "#{theme}/topmenu.css" %>
  <%= stylesheet_link_tag "#{theme}/navmenu.css" %>
  <%= stylesheet_link_tag "#{theme}/puavo.css" %>

  <%= javascript_include_tag "jquery-1.4.2.min", "rails", "application" %>

  <meta name="csrf-token" content="<%= form_authenticity_token %>" />
  <meta name="csrf-param" content="authenticity_token" />
</head>
<body>
  <div class="container">
    <ul id="top-menu" class="menu">
      <% if organisation_owner? %>
      <li>
	<%= link_to session[:organisation].name, "/users/organisation", :class => "sub" %>
	<ul>
	  <li><%= link_to t('.external_services'), "/users/external_services" %></li>
	  <li><%= link_to t('.printers'), printers_path %></li>
	  <li><%= link_to t('.servers'), servers_path %></li>
	</ul>
      </li>
      <% else %>
      <li><span class="sub"><%= session[:organisation].name %></span></li>
      <% end %>
      <li><a href="/users/schools" class="sub"><%= t('.schools')%></a>
        <ul>
          <% session[:organisation].schools.each do |school| %>
          <li<% if session[:organisation].schools.last == school %> class="last"<% end %>><%= link_to school.displayName,  devices_path(school) %></li>
          <% end %>
        </ul>
      </li>

      <% if logged_in? %>
      <div id="top-menu-right">
        <li><span><%= t('.logged_in_as') %></span></li>
      <li><a href="#"><%= current_user_displayName %></a></li>
      <li><%= link_to t('.logout'), logout_path, :method => :delete %></li>
      </div>
      <% end %>
    </ul> <!-- top-menu -->

    <hr class="space" />

    <% if session[:organisation] %>
    <% if @school && !@school.id.nil? && controller_name != 'password' %>
    <h1><%= @school.displayName %></h1>

    <div id="navbar_first_level">
      <div id="nav1">
        <ul>
          <li class="<%= controller_name.match(/schools/) \
                     ? "page_item current_page_item" \
                                                    : "page_item" %>">
            <a href="/users/schools/<%= @school.id %>"><span><%= t('.school') %></span></a>
          </li>
          <li class="<%= controller_name.match(/users|groups|roles/) ? "page_item current_page_item" : "page_item" %>">
            <a href="/users/<%= @school.id%>/users"><span><%= t('.users') %></span></a>
          </li>
          <li class="<%= controller_name.match(/devices/) ? "page_item current_page_item" : "page_item" %>">
            <% link_to devices_path(@school) do %>
            <span><%= t('.devices') %></span>
            <% end %>
          </li>
          <% if @oauth_applications %>
          <% @oauth_applications.each do |app| %>
          <li class="page_item"><a href="<%= app.url %>" title="<%= app.name %>"><span><%= app.name %></span></a></li>
          <% end %>
          <% end %>
        </ul>
      </div><!-- nav1 -->
    </div><!-- navbar_first_level -->

    <div id="navbar_second_level">&nbsp;
      <%= render :partial => "#{controller_name}/menu.html.erb" rescue nil %>
    </div><!-- navbar_second_level -->

    <% end %>
    <% end %>

    <hr class="space" />

    <div class="maincontent">
      <% if flash.has_key?(:notice) %>
      <% if flash.has_key?(:notice_css_class) %>
      <p class='<%= flash[:notice_css_class] %>'>
        <% else %>
      <p class="notice">
        <% end %>
        <%= flash[:notice] %>
      </p>
      <% end %>
      <%= yield %>
    </div>

    <% if logged_in? %>
    <div class="tools">
      <h1><%= t('.tools') %></h1>
      <%= yield :right %>
    </div>
    <% end %>

  </div> <!-- container -->

</body>
</html>
