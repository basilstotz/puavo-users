// Generated by CoffeeScript 1.3.3
(function() {
  var Login;

  Login = (function() {

    Login.prototype.$ = function(selector) {
      return $(selector, this.$el);
    };

    function Login(_arg) {
      var el,
        _this = this;
      el = _arg.el;
      this.$el = $(el);
      this.selection = this.$(".chzn-select");
      if (localStorage.lastUsedOrgKey) {
        this.selectOrganisation(localStorage.lastUsedOrgKey);
        this.loginOnly();
      } else {
        this.organisationSelectionOnly();
      }
      this.selection.chosen({
        no_results_text: "Organisaatioita ei l√∂ydy sanalla: "
      });
      this.$("button.next").click(function(e) {
        e.preventDefault();
        _this.selectOrganisation($("select").get(0).value);
        return _this.loginOnly();
      });
      this.$("a.change-organization").click(function(e) {
        e.preventDefault();
        return _this.organisationSelectionOnly();
      });
      this.$("form").submit(function() {
        _this.$("input").addClass("disabled");
        _this.$("img.loading").css("display", "inline");
        return $("input").click(function(e) {
          return e.preventDefault();
        });
      });
    }

    Login.prototype.selectOrganisation = function(orgKey) {
      var humanName;
      this.selection.val(orgKey);
      humanName = this.$("option[value=" + orgKey + "]").text();
      this.$(".chosen-organization .container").text(humanName);
      return localStorage.lastUsedOrgKey = orgKey;
    };

    Login.prototype.organisationSelectionOnly = function() {
      this.$el.addClass("organisation-only");
      this.$el.removeClass("login-only");
      return this.selection.get(0).focus();
    };

    Login.prototype.loginOnly = function() {
      this.$el.addClass("login-only");
      this.$el.removeClass("organisation-only");
      return this.$("#oauth_uid").get(0).focus();
    };

    return Login;

  })();

  $(function() {
    return window.login = new Login({
      el: $("body").get(0)
    });
  });

}).call(this);
